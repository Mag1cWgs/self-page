## 1. 变量

### 1.1 定义与声明
程序运行中可变的值，是基本存储单元，既表示该块内存空间的地址，又表示该块内存空间所存储的数据。

- 语法格式如下：
    ```cs
        [访问修饰符] 数据类型 变量名 [=初始值];   // [可选项]
        // 不初始化时默认为 0 / 0.0 / '\0' / null / false 等初始值
    ```
- 可以一次声明一个或多个
    ```cs
    int exampleIntger = 20;
    string name1 = "name1" , name2 = "name2";
    ```
- 也可以使用 `var` 关键字实现**类型推断**
    - `var` 是从 C# 3.0 开始引入的新关键字
    - 在定义变量时替代数据类型，必须同时初始化
        - 该变量为**隐式类型**的变量
    - 语法格式如下：
        ```cs
        var 变量名 = 初始值;
        ```

### 1.2 从名称、值、数据类型、作用域与生命周期理解变量
定义任何变量时，系统会在内存中开辟相应大小的空间来存放数据。

1. 变量的名称
    - 可以是任意合法的标识符
        - 推荐看[命名规范](/ProjectDocs/cs/Back-end-Development/Csharp-OOP/NameRules.md)
    - 定义变量时，会根据数据类型分配相应大小的内存空间，其可以存放数据
        - 变量名称与相应内存空间绑定
        - 对变量操作本质是对内存空间操作

2. 变量的值
    - 表示变量名称所指空间内存储内容
    - 必须先定义后使用，使用前必须赋值。
        - 定义是可以不直接赋值，后续代码使用前赋值即可
    - 不允许使用未初始化变量
        - 但是不符只是会有默认构造函数设定初值
    
    > [!note|label:各类型变量默认初始值]
    > 类型 | 默认初始值
    > -----|----------
    > 数值类型 | `0` 或 `0.0`
    > `char` | `'\0'`
    > `object` (除了简单值类型外所有) | `null`
    > `bool` | `false`

3. 变量的数据类型
    - 决定其容纳类型数据、数值取值范围、有什么操作

4. 变量的作用域和生命周期
    - 作用范围就是作用域，变量定义到销毁的时间为生命周期


## 2. 值类型变量与引用类型变量的区别
- 程序运行时，操作系统会为其分配空间用于存放临时数据。
- 分配空间分为**栈空间**和**堆空间**
    - 栈空间: 值类型数据
    - 堆空间: 引用类型数据（对象）

> [!tip]
> - 值类型派生自`System.ValueType`（派生自`System.Object`）
> - 值类型包括**且仅**包括: 
>     - sbyte、byte、short、ushort、int、uint、long、ulong
>     - float、double、decimal
>     - bool、char、枚举
>     - 自定义struct
> - 引用类型包括**且仅**包括：
>     - 类、接口、数组、委托


### 2.1 栈空间和堆空间
> 参看: [C# 内存 栈、托管堆、非托管堆、静态数据区、常量数据区、程序代码区](https://www.cnblogs.com/buzheng11/p/17661667.html)

1. 栈空间
    - 先进后出 FILO(First In Last Out) 的数据结构
    - 存储以下类型数据: 
        - 某些类型变量的值
        - 程序当前的执行环境
        - 传递给方法的参数
    - 由系统管理栈空间操作
        - 进栈（压栈）`PUSH`
        - 出栈（弹出）`POP`
            - 出栈后空间由系统自动收回

2. 堆空间
    - 一块内存空间
    - 可以分配大块内存以存储某类型的数据对象
    - 堆内空间可以任意顺序存入和移除
    - 程序可以在堆空间保存数据，但不能显式删除
        - CLR 的垃圾回收器在判断程序的代码不会再访问某数据时会自动清除无用的堆数据对象

    > [!note]
    > CLR: Common Language Runtime 公共语言运行库，
    > 是.NET框架的核心组件，位于操作系统底层，负责管理程序运行。  
    > 包含了 CTS (Common Language Specification 公共语言规范) 和
    > CTS (Common Type System 通用类型系统)。

### 2.2 理解值类型的变量
- C#中的值类型变量类似于C/C++中的非指针变量
   - 其直接包含它们的值
   - 值类型隐式派生自 `System.ValueType`
- C#中，在内存的**栈空间**内为值类型变量分配空间
    - 没有单独的堆分配或者垃圾回收器开销
    - 会随着方法调用后栈空间消亡而自动清除
        - 类似C/C++中的局部变量，函数执行后系统释放其存储空间
- 定义值类型变量并赋值时
    - 只能存储相同类型数据
        - 可以通过类型的转换（显式/隐式）
    - 赋值时实际创建值的副本，而后指定变量名指向值副本的存储位置
        - 与引用变量不同！

### 2.3 理解引用类型的变量
- C/C++中存在指针变量
    - 例如：`char *p = 'e'` 表明 `p` 是一个指针变量，其值为存储 `char` 型字符 `e` 的内存空间的地址
        - `p` 存储的是一个地址，而 `*p` 是 `e` 这个值

        > [!note|label:回顾指针相关定义]
        > - `int *p`
        >   - int *p表示的是一级指针，表示p所指向的地址里面存放的是一个int类型的值。
        >   - 一级指针存放变量的地址，指向的值是变量的内容。如`int* p={1,2,3}`， `p=数组的首地址`，`*p=数组的第一个值`；
        >   - 一级指针通过形参，可以修改实参中指针所指向的地址中的值。
        >       - 修改不了实参中指针所指向的地址。需要借助二级指针才可以。
        > - `int **p`
        >   - `int **p`表示的是二级指针，表示p所指向的地址(即`*p`变量地址)里面存放的是一个指向int类型的指针(即`p`)。
        >   - 二级指针(`**p`)存放一级指针(`*p`)的地址，指向一级指针。
        >       - 如`int *p ={1,2,3}`
        >           - `int **pp=&p`
        >           - `pp=指针p的首地址`
        >           - `*pp=数组的首地址`
        >           - `**pp=数组第一个值1`。
        >   - 指针数组的数组名传递参数对应为指针的指针即二级指针，二维数组的数组名传递参数对应为数组指针即指向一维数组的指针
        >       - 如`int ex[2][2]`中，`ex`实际是`*(*ex)`，而`ex[]`实际是`*(ex[])`
        > - `int (*p)()`
        >   - 理解为函数，满足 `[修饰符] 返回类型int 变量名(*p) 参数()` 格式
        >       - `(*p)`这个整体可以看作是函数名称，`p`代表函数的入口地址。
        > - `int *p()`
        >   - 同样理解为函数，返回值是一个指向`int`型的指针
        > - `int *p[n]`
        >   - `int *p[n]` 就是一个指针数组
        >       - 数据类型为`int` ，元素为地址（变量地址，数组地址，函数地址等）,也就是说定义了n个不同指向int型的指针。
        >   - 在字符优先级表中，`[]`的优先级大于`*`，所以，`int *p[n]` 就等价于`int *(p[n])`。
        > - `int (*p)[n]`
        >   - 同上，根据优先级，`int (*p)[n]`表示定义一个指针，指向一个`int[n]`型的指针。

- C#中没有指针，改用引用。
    - 引用: 某个对象的地址，而非变量或者对象本身。
        - 变量<=>对象 关系类似于C/C++上指针
        - 但是C#中引用类型变量所指向对象（全局性生命周期）均是在托管堆上分配内存空间
            - 避免内存泄漏
            - 从 .NET Framework (.NET框架) 对C++等的改进，将应用程序置于CLR监控下
            - 程序执行完毕后CLR将堆空间全部收回


- C#中定义一个引用类型变量
    - 语法格式如下:
        ```cs
        ClassName varName;
        varName = new ClassName(构造所需参数);
        ```
        - 先在栈空间为引用变量 `varName` 分配了存储空间，并指向默认的 `null`
        - 再用 `new` 操作符在堆上分配一个 `ClassName` 类型的实例化对象
        - 再把其存储地址赋给`varName`

    > [!tip|label:与C/C++不同]
    > - 在C/C++中，指针变量可以指向相应类型的某个变量，也可以指向没有变量名的内存空间。
    > - 在C#中，引用类型变量指向的实例都没有名称概念，因而不用指针概念。
    >     - 指向的实例统一在堆空间内分配存储空间，以便于统一收回

## 3. 常量
- 一般分为直接常量和符号常量。
- 类型可以是任何一种值类型/引用类型。

### 3.1 直接常量
- 将程序中不变量直接硬编码成数值/字符串值
- 有默认的判断方法
    - 数值常数不带小数点 => 整型
        - 按照 `int` => `uint` => `long` => `ulong` 判断
    - 数值常数带小数点 => 浮点型 `double`
- 也可以用数值加后缀来制定数值类型
    - `u`/`U`: 整型常数后，按照 `uint` => `ulong` 判断
    - `l`/`L`: 整型常数后，按照 `long` => `ulong` 判断
    - `ul`: 表示为 `ulong`
    - `f`/`F`: 表示为 `float`
    - `d`/`D`: 表示为 `double`
    - `m`/`M`: 表示为 `decimal`

### 3.2 符号常量
- 使用关键字 `const` 声明的常量，包括常量名和常量值
- 语法格式如下:
    ```cs
    const ConstDataType varName = 初始值;
    ```
    - 其中 `varName` 必须是C#的合法标识符，在程序中通过 `varName` 来访问该常量
- 有如下特点：
    - 只能被赋予初始值，在编译时固定值，运行过程中不改变
    - 定义时只能用常量和常数定义，不能用变量

> [!note|label:几种常量修饰符的区别]
> 
> 修饰符名 | 初始化时机 | 值状态 | 修饰范围 | 主要运用场景
> --------|-----------|--------|--------|-------------
> `const` | 编译时，即编译程序时将值已经嵌入代码中 | 不允许动态修改 | 字段、局部变量 | 主要应用于程序运行中不需要改变的变量的值，比如数学符号PI
> `static` | 运行时，可以声明时赋值，也可以在构造函数，或使用时赋值 | 允许修改（类成员共有） | 类、字段、属性、方法、运算符、事件、构造函数<br> （不能用于索引器、析构函数或类以外的类型） | 主要作用于类的公共属性
> `readonly` | 运行时，可以声明时赋值或在类中的构造函数中赋值 | 允许修改，但只能在构造函数中修改（构造后固定，各实例不同） | 字段 | 主要作用于实例化的对象的只读属性
> `static readonly` | 运行时，是两个关键字的组合 | 允许修改，声明时赋值或者静态构造函数中赋值 | 字段 | 第一: `static readonly` 主要应用于**各类型引用性变量**，而 `const` 只能用于 `string` 类型的**引用性变量** <br> 第二: 类的只读公共属性



## 参考链接
- 微软官方文档
    - [C# 类型系统](https://learn.microsoft.com/zh-cn/dotnet/csharp/fundamentals/types/)
    - [值类型（C# 参考）](https://learn.microsoft.com/zh-cn/dotnet/csharp/language-reference/builtin-types/value-types)
        - [枚举类型（C# 参考）](https://learn.microsoft.com/zh-cn/dotnet/csharp/language-reference/builtin-types/enum)
        - [结构类型（C# 参考）](https://learn.microsoft.com/zh-cn/dotnet/csharp/language-reference/builtin-types/struct)
            - [ref 结构类型（C# 参考）](https://learn.microsoft.com/zh-cn/dotnet/csharp/language-reference/builtin-types/ref-struct)
    - [引用类型（C# 参考）](https://learn.microsoft.com/zh-cn/dotnet/csharp/language-reference/keywords/reference-types)
    - [9 变量](https://learn.microsoft.com/zh-cn/dotnet/csharp/language-reference/language-specification/variables)
- [C#托管堆和垃圾回收（GC）](https://www.cnblogs.com/xiaoxiaotank/p/11193745.html)
- [.net托管与非托管以及GC(垃圾回收)](https://blog.csdn.net/liuyongjie1992/article/details/122308450)
- [C#的GC机制与优化](https://rhodi2436.github.io/posts/C-%E7%9A%84GC%E6%9C%BA%E5%88%B6%E4%B8%8E%E4%BC%98%E5%8C%96/)
